<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DeepSeek</title>
  <!-- 引入 DeepSeek 官方字体 -->
  <style>
    @font-face {
      font-family: 'DeepSeekFont';
      src: url('fontDS.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'DeepSeekFont', sans-serif;
    }

    /* ===== 主题色彩变量 ===== */
    :root {
      --color-bg-main-light: #FFFFFF;       /* 主背景：白色 */
      --color-bg-sidebar-light: #F5F5F5;    /* 侧边栏背景：浅灰 */
      --color-bg-chat-light: #FFFFFF;       /* 聊天区背景：白色 */
      --color-bg-input-light: #EEEEEE;      /* 输入区背景：更浅灰 */
      --color-bubble-ai-light: #E5E5E5;     /* AI 气泡背景：浅灰 */
      --color-bubble-user-light: #D3D3D3;   /* 用户气泡背景：灰 */
      --color-text-light: #1A1A1A;          /* 浅色主题文字：深灰 */
      --color-icon-light: #1A1A1A;          /* 浅色图标：深灰 */
      --color-border-light: #DDDDDD;        /* 浅色边框：浅灰 */

      --color-bg-main-dark: #18191A;        /* 主背景：深色 */
      --color-bg-sidebar-dark: #202225;     /* 侧边栏深色 */
      --color-bg-chat-dark: #18191A;        /* 聊天区深背景 */
      --color-bg-input-dark: #202225;       /* 输入区深背景 */
      --color-bubble-ai-dark: #282B30;      /* AI 气泡深灰 */
      --color-bubble-user-dark: #5865F2;    /* 用户气泡深蓝 */
      --color-text-dark: #E3E5E8;           /* 深色文字：浅灰 */
      --color-icon-dark: #E3E5E8;           /* 深色图标：浅灰 */
      --color-border-dark: #2F3136;         /* 深色边框：深灰 */
    }

    /* ===== 默认浅色主题 ===== */
    body.light {
      background-color: var(--color-bg-main-light);
      color: var(--color-text-light);
    }
    body.light .sidebar {
      background-color: var(--color-bg-sidebar-light);
      border-top: 1px solid var(--color-border-light);
    }
    body.light .chat-window {
      background-color: var(--color-bg-chat-light);
    }
    body.light .chat-input {
      background-color: var(--color-bg-input-light);
      border-top: 1px solid var(--color-border-light);
    }
    body.light .chat-input input {
      background-color: var(--color-bg-input-light);
      color: var(--color-text-light);
    }
    body.light .chat-input input::placeholder {
      color: #888888;
    }
    body.light .message.ai .bubble {
      background-color: var(--color-bubble-ai-light);
      color: var(--color-text-light);
    }
    body.light .message.user .bubble {
      background-color: var(--color-bubble-user-light);
      color: var(--color-text-light);
    }
    body.light .icon-btn svg path,
    body.light .menu-btn svg path {
      stroke: var(--color-icon-light);
      fill: var(--color-icon-light);
    }
    body.light .new-chat-btn {
      background-color: var(--color-bubble-user-light);
      color: var(--color-text-light);
      border: 1px solid var(--color-border-light);
    }
    body.light .sidebar-footer {
      border-top: 1px solid var(--color-border-light);
    }
    body.light .sidebar-footer .profile-pic {
      background: #CCCCCC;
    }
    body.light .menu-panel {
      background-color: var(--color-bg-sidebar-light);
      border: 1px solid var(--color-border-light);
    }
    body.light .menu-panel li {
      color: var(--color-text-light);
    }
    body.light .menu-panel li:hover {
      background-color: var(--color-border-light);
    }

    /* ===== 深色主题 ===== */
    body.dark {
      background-color: var(--color-bg-main-dark);
      color: var(--color-text-dark);
    }
    body.dark .sidebar {
      background-color: var(--color-bg-sidebar-dark);
    }
    body.dark .chat-window {
      background-color: var(--color-bg-chat-dark);
    }
    body.dark .chat-input {
      background-color: var(--color-bg-input-dark);
      border-top: 1px solid var(--color-border-dark);
    }
    body.dark .chat-input input {
      background-color: var(--color-bg-input-dark);
      color: var(--color-text-dark);
    }
    body.dark .chat-input input::placeholder {
      color: #AAAAAA;
    }
    body.dark .message.ai .bubble {
      background-color: var(--color-bubble-ai-dark);
      color: var(--color-text-dark);
    }
    body.dark .message.user .bubble {
      background-color: var(--color-bubble-user-dark);
      color: var(--color-text-dark);
    }
    body.dark .icon-btn svg path,
    body.dark .menu-btn svg path {
      stroke: var(--color-icon-dark);
      fill: var(--color-icon-dark);
    }
    body.dark .new-chat-btn {
      background-color: var(--color-bubble-user-dark);
      color: var(--color-text-dark);
      border: none;
    }
    body.dark .sidebar-footer {
      border-top: 1px solid var(--color-border-dark);
    }
    body.dark .sidebar-footer .profile-pic {
      background: #555555;
    }
    body.dark .menu-panel {
      background-color: var(--color-bg-sidebar-dark);
      border: 1px solid var(--color-border-dark);
    }
    body.dark .menu-panel li {
      color: var(--color-text-dark);
    }
    body.dark .menu-panel li:hover {
      background-color: var(--color-border-dark);
    }

    /* ===== 全局布局与样式 ===== */
    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;
      transition: background-color 0.3s, color 0.3s;
    }
    .container {
      display: flex;
      height: 100vh;
      width: 100%;
    }

    /* ===== 菜单按钮（灰色三条杠） ===== */
    .menu-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      width: 36px;
      height: 36px;
      background-color: #CCCCCC;
      border: none;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 11;
      transition: background 0.2s;
    }
    .menu-btn:hover {
      background-color: #AAAAAA;
    }
    .menu-btn svg {
      width: 24px;
      height: 24px;
      stroke: #333333;
      fill: none;
      stroke-width: 2;
    }

    /* ===== 弹出菜单（用于切换主题 & 清除记录） ===== */
    .menu-panel {
      position: absolute;
      top: 56px; /* 菜单按钮下方 */
      left: 10px;
      width: 180px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: none;
      z-index: 12;
    }
    .menu-panel ul {
      list-style: none;
    }
    .menu-panel li {
      padding: 10px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .menu-panel li + li {
      border-top: 1px solid var(--color-border-light);
    }

    /* ===== 侧边栏 ===== */
    .sidebar {
      width: 280px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: background-color 0.3s, transform 0.3s;
    }
    .sidebar-header {
      display: flex;
      align-items: center;
      padding: 20px;
    }
    .sidebar-header img {
      width: 32px;
      height: 32px;
      margin-right: 10px;
    }
    .sidebar-header span {
      font-size: 1.2rem;
      font-weight: bold;
    }
    .new-chat-btn {
      display: flex;
      align-items: center;
      margin: 10px 20px;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .new-chat-btn:hover {
      opacity: 0.85;
    }
    .new-chat-btn svg {
      width: 18px;
      height: 18px;
      margin-right: 8px;
      stroke: currentColor;
      fill: currentColor;
    }
    .chat-list {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      font-size: 0.9rem;
      line-height: 1.5;
      text-align: center;
    }
    .chat-list p {
      color: #7a7c80;
    }
    .sidebar-footer {
      display: flex;
      align-items: center;
      padding: 20px;
      transition: border-color 0.3s;
    }
    .profile-pic {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #CCCCCC;
      margin-right: 12px;
    }
    .profile-name {
      font-size: 1rem;
    }

    /* ===== 主区域 ===== */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      transition: background-color 0.3s;
    }
    .chat-window {
      flex: 1;
      padding: 20px 24px;
      overflow-y: auto;
      scrollbar-width: none;
      transition: background-color 0.3s;
    }
    .chat-window::-webkit-scrollbar {
      display: none;
    }

    /* ===== 消息气泡 & 动画 ===== */
    .message {
      display: flex;
      margin-bottom: 16px;
      opacity: 0;
      transform: translateY(20px);
      animation: slide-in 0.25s forwards; /* 滑入动画 */
    }
    @keyframes slide-in {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .message.ai {
      justify-content: flex-start;
    }
    .message.user {
      justify-content: flex-end;
    }
    .message .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      margin-right: 8px;
      flex-shrink: 0;
    }
    .message .bubble {
      max-width: 65%;
      padding: 10px 14px;
      font-size: 1rem;
      line-height: 1.5;
      word-break: break-word;
      border-radius: 12px;
      transition: background-color 0.3s, color 0.3s;
    }
    .message.ai .bubble {
      border-radius: 12px 12px 12px 0px;
    }
    .message.user .bubble {
      border-radius: 12px 12px 0px 12px;
    }

    /* ===== 输入区 ===== */
    .chat-input {
      display: flex;
      align-items: center;
      padding: 10px 20px;
      border-top: 1px solid;
      transition: background-color 0.3s, border-color 0.3s;
    }
    .chat-input input {
      flex: 1;
      height: 40px;
      padding: 0 14px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      outline: none;
      transition: background-color 0.3s, color 0.3s;
    }
    .chat-input input::placeholder {
      color: inherit;
      opacity: 0.6;
    }
    .icon-btn {
      width: 40px;
      height: 40px;
      margin-left: 12px;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s, color 0.3s;
      flex-shrink: 0;
    }
    .icon-btn:hover {
      opacity: 0.85;
    }
    .icon-btn svg {
      width: 20px;
      height: 20px;
      stroke: currentColor;
      fill: currentColor;
    }

    /* ===== 加载动画样式 ===== */
    .loading-container {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
    }
    .loading-gif {
      width: 32px;
      height: 32px;
    }

    /* ===== 响应式折叠侧边栏 ===== */
    @media (max-width: 600px) {
      .sidebar {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        transform: translateY(-100%);
        z-index: 10;
      }
      .sidebar.visible {
        transform: translateY(0);
      }
      .main {
        margin-top: 60px;
      }
    }
  </style>

  <!-- 网站图标 -->
  <link rel="icon" href="deepseek.png" type="image/png" />
</head>
<body>
  <div class="container">
    <!-- 灰色三条杠菜单按钮 -->
    <button class="menu-btn" id="menuBtn" title="菜单">
      <!-- 三条杠 SVG 图标 -->
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <!-- 弹出菜单：切换主题 & 清除记录 -->
    <div class="menu-panel" id="menuPanel">
      <ul>
        <li id="toggleThemeMenu">切换浅/深色主题</li>
        <li id="clearChatMenu">清除聊天记录</li>
      </ul>
    </div>

    <!-- 侧边栏 -->
    <aside class="sidebar" id="sidebar">
      <div>
        <!-- Logo 区域 -->
        <div class="sidebar-header">
          <img src="deepseek.png" alt="DeepSeek 图标" />
          <span>DeepSeek</span>
        </div>
        <!-- 新对话 按钮 -->
        <button class="new-chat-btn" id="newChatBtn">
          <!-- “+” 图标 SVG -->
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <span>新对话</span>
        </button>
        <!-- 聊天历史列表 -->
        <div class="chat-list" id="chatList">
          <p>无对话记录</p>
        </div>
      </div>
      <!-- 侧边栏底部：我的资料 -->
      <div class="sidebar-footer">
        <div class="profile-pic"></div>
        <div class="profile-name">我的资料</div>
      </div>
    </aside>

    <!-- 主区域 -->
    <div class="main">
      <!-- 聊天窗口 -->
      <div class="chat-window" id="chatWindow">
        <!-- 聊天记录将由 JS 动态恢复/插入 -->
      </div>
      <!-- 输入区域 -->
      <div class="chat-input">
        <input type="text" id="userInput" placeholder="请输入消息" autocomplete="off" />
        <!-- 深度思考 按钮 -->
        <button class="icon-btn" id="deepThinkBtn" title="深度思考">
          <!-- Brain 图标 SVG -->
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2a4 4 0 0 0-4 4v3a4 4 0 1 0 8 0V6a4 4 0 0 0-4-4Zm0 2a2 2 0 0 1 2 2v3a2 2 0 1 1-4 0V6a2 2 0 0 1 2-2Zm-6 9a1 1 0 0 0 0 2h12a1 1 0 1 0 0-2H6Zm-1 4a1 1 0 0 0-1 1 5 5 0 0 0 5 5h2a5 5 0 0 0 5-5 1 1 0 1 0-2 0 3 3 0 0 1-3 3H10a3 3 0 0 1-3-3 1 1 0 0 0-1-1Z" fill="currentColor"/>
          </svg>
        </button>
        <!-- 搜索 按钮 -->
        <button class="icon-btn" id="searchBtn" title="搜索">
          <!-- Magnifier 图标 SVG -->
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" fill="none"/>
            <line x1="16.65" y1="16.65" x2="21" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- 自定义回复映射表 -->
  <script src="responses.js"></script>

  <!-- 前端脚本：菜单控制、主题切换、自动保存/清除记录、消息插入、加载动画、延迟与逐字符显示 -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const bodyEl = document.body;
      const sidebar = document.getElementById('sidebar');
      const menuBtn = document.getElementById('menuBtn');
      const menuPanel = document.getElementById('menuPanel');
      const toggleThemeMenu = document.getElementById('toggleThemeMenu');
      const clearChatMenu = document.getElementById('clearChatMenu');
      const newChatBtn = document.getElementById('newChatBtn');
      const chatList = document.getElementById('chatList');
      const chatWindow = document.getElementById('chatWindow');
      const userInput = document.getElementById('userInput');
      const deepThinkBtn = document.getElementById('deepThinkBtn');
      const searchBtn = document.getElementById('searchBtn');

      // ===== 自动加载历史聊天记录 =====
      function loadChatHistory() {
        const saved = localStorage.getItem('deepseek_chat_history');
        if (saved) {
          chatWindow.innerHTML = saved;
          // 移除已完成消息的动画属性，避免再次加载时动画重放
          const msgs = chatWindow.querySelectorAll('.message');
          msgs.forEach(msg => {
            msg.style.opacity = '1';
            msg.style.transform = 'translateY(0)';
          });
          // 清空侧边栏占位
          chatList.innerHTML = '';
        }
      }
      loadChatHistory();

      // ===== 自动保存当前聊天记录到 localStorage =====
      function saveChatHistory() {
        localStorage.setItem('deepseek_chat_history', chatWindow.innerHTML);
      }

      // ===== 菜单按钮：点击显示/隐藏菜单面板 =====
      menuBtn.addEventListener('click', () => {
        menuPanel.style.display = menuPanel.style.display === 'block' ? 'none' : 'block';
      });
      // 点击页面其他位置关闭菜单
      document.addEventListener('click', function(e) {
        if (!menuBtn.contains(e.target) && !menuPanel.contains(e.target)) {
          menuPanel.style.display = 'none';
        }
      });

      // ===== 主题初始化：根据系统 prefers-color-scheme 设置默认 =====
      function initTheme() {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          bodyEl.classList.add('dark');
        } else {
          bodyEl.classList.add('light');
        }
      }
      initTheme();

      // ===== 菜单里的“切换浅/深色主题”功能 =====
      toggleThemeMenu.addEventListener('click', () => {
        if (bodyEl.classList.contains('light')) {
          bodyEl.classList.remove('light');
          bodyEl.classList.add('dark');
        } else {
          bodyEl.classList.remove('dark');
          bodyEl.classList.add('light');
        }
        menuPanel.style.display = 'none';
      });

      // ===== 菜单里的“清除聊天记录”功能 =====
      clearChatMenu.addEventListener('click', () => {
        chatWindow.innerHTML = '';
        chatList.innerHTML = '<p>无对话记录</p>';
        localStorage.removeItem('deepseek_chat_history');
        menuPanel.style.display = 'none';
      });

      // ===== 移动端响应式：折叠/展开侧边栏 =====
      function updateLayout() {
        if (window.innerWidth <= 600) {
          sidebar.classList.remove('visible');
        } else {
          sidebar.classList.remove('visible');
        }
      }
      updateLayout();
      window.addEventListener('resize', updateLayout);

      // ===== 新对话 按钮：清空聊天并清除占位 =====
      newChatBtn.addEventListener('click', () => {
        chatWindow.innerHTML = '';
        chatList.innerHTML = '<p>无对话记录</p>';
        localStorage.removeItem('deepseek_chat_history');
      });

      // ===== 插入单条消息到聊天窗口 =====
      function addMessage(text, sender) {
        const messageEl = document.createElement('div');
        messageEl.classList.add('message', sender);

        // 如果是 AI 消息，则先插入头像
        if (sender === 'ai') {
          const avatarEl = document.createElement('img');
          avatarEl.src = 'deepseek.png';
          avatarEl.alt = 'DeepSeek 头像';
          avatarEl.classList.add('avatar');
          messageEl.appendChild(avatarEl);
        }

        const bubbleEl = document.createElement('div');
        bubbleEl.classList.add('bubble');
        // 若 sender === 'ai'，此时不直接填充文字，而留空，等待逐字符显示
        if (sender === 'user') {
          bubbleEl.textContent = text;
        }
        messageEl.appendChild(bubbleEl);
        chatWindow.appendChild(messageEl);

        // 滑入动画
        setTimeout(() => {
          messageEl.style.opacity = '1';
          messageEl.style.transform = 'translateY(0)';
        }, 10);

        // 滚动到底部
        chatWindow.scrollTop = chatWindow.scrollHeight;

        // 保存最新聊天历史
        saveChatHistory();

        return bubbleEl; // 返回气泡元素，用于逐字符填充
      }

      // ===== 从 responses.js 获取 AI 回复 =====
      function getResponse(input) {
        const key = input.trim();
        if (window.responses && window.responses[key] !== undefined) {
          return window.responses[key];
        } else {
          return '服务器繁忙，请稍后再试';
        }
      }

      // ===== 逐字符滚动显示内容（90ms/字符 ≈ 11–12 字符/秒） =====
      function typeText(element, text, speed = 90) {
        let index = 0;
        element.textContent = '';
        return new Promise(resolve => {
          const intervalId = setInterval(() => {
            if (index < text.length) {
              element.textContent += text.charAt(index);
              index++;
            } else {
              clearInterval(intervalId);
              // 保存聊天记录
              saveChatHistory();
              resolve();
            }
          }, speed);
        });
      }

      // ===== 发送消息：用户 → AI =====
      async function sendMessage() {
        const text = userInput.value.trim();
        if (!text) return;

        // 首次消息时清空侧边栏占位
        if (chatList.innerHTML.trim() !== '') {
          chatList.innerHTML = '';
        }

        // 1. 插入用户消息
        addMessage(text, 'user');
        userInput.value = '';

        // 2. 插入 AI 消息容器（带头像 & loading 动画）
        const loadingContainer = document.createElement('div');
        loadingContainer.classList.add('message', 'ai');
        // DeepSeek 头像
        const avatarEl = document.createElement('img');
        avatarEl.src = 'deepseek.png';
        avatarEl.alt = 'DeepSeek 头像';
        avatarEl.classList.add('avatar');
        loadingContainer.appendChild(avatarEl);
        // 加载动画
        const loadingGif = document.createElement('img');
        loadingGif.src = 'jz.gif'; /* 加载动画 */
        loadingGif.alt = '加载中';
        loadingGif.classList.add('loading-gif');
        loadingContainer.appendChild(loadingGif);
        chatWindow.appendChild(loadingContainer);

        // 滑入动画
        setTimeout(() => {
          loadingContainer.style.opacity = '1';
          loadingContainer.style.transform = 'translateY(0)';
        }, 10);
        // 滚动到底部
        chatWindow.scrollTop = chatWindow.scrollHeight;

        // 3. 模拟 DeepSeek 思考延迟：5–7 秒
        const delay = 5000 + Math.random() * 2000;
        await new Promise(res => setTimeout(res, delay));

        // 4. 移除 loading 动画
        loadingGif.remove();

        // 5. 获取 AI 回复
        const reply = getResponse(text);

        // 6. 在同一个 message 元素内插入 bubble，并逐字符显示
        const bubbleEl = document.createElement('div');
        bubbleEl.classList.add('bubble');
        loadingContainer.appendChild(bubbleEl);

        // 7. 逐字符呈现 AI 回复
        await typeText(bubbleEl, reply, 90);
      }

      // 点击“深度思考”或“搜索”按钮都触发 sendMessage
      deepThinkBtn.addEventListener('click', sendMessage);
      searchBtn.addEventListener('click', sendMessage);

      // 按 Enter 键发送
      userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });
    });
  </script>
</body>
</html>