<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>DeepSeek</title>
  <style>
    @font-face {
      font-family: 'DeepSeekFont';
      src: url('fontDS.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'DeepSeekFont', sans-serif;
    }
    html, body {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background-color: #FFFFFF;
      color: #1A1A1A;
      touch-action: manipulation;
    }
    body.dark {
      background-color: #18191A;
      color: #E3E5E8;
    }
    .container {
      display: flex;
      width: 100%;
      height: 100%;
    }
    /* ===== 侧边栏 ===== */
    .sidebar {
      flex-shrink: 0;
      background-color: #F5F5F5;
      width: 25%;
      max-width: 300px;
      min-width: 200px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: background-color 0.3s;
    }
    body.dark .sidebar {
      background-color: #202225;
    }
    .sidebar-header {
      display: flex;
      align-items: center;
      padding: 16px;
    }
    .sidebar-header img {
      width: 28px;
      height: 28px;
      margin-right: 8px;
    }
    .sidebar-header span {
      font-size: 1rem;
      font-weight: bold;
    }
    .new-chat-btn {
      display: flex;
      align-items: center;
      margin: 8px 16px;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.9rem;
      cursor: pointer;
      background-color: transparent;
      border: 1px solid transparent;
      transition: background 0.2s;
    }
    .new-chat-btn img {
      width: 20px;
      height: 20px;
      margin-right: 6px;
    }
    .new-chat-btn:hover {
      background-color: rgba(0,0,0,0.05);
    }
    body.dark .new-chat-btn:hover {
      background-color: rgba(255,255,255,0.1);
    }
    .chat-list {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      font-size: 0.85rem;
      line-height: 1.4;
      text-align: center;
    }
    .chat-list p {
      color: #7a7c80;
    }
    .sidebar-footer {
      display: flex;
      align-items: center;
      padding: 12px;
      border-top: 1px solid #DDDDDD;
    }
    body.dark .sidebar-footer {
      border-top: 1px solid #2F3136;
    }
    .profile-pic {
      position: relative;
      width: 32px;
      height: 32px;
      margin-right: 6px;
    }
    .profile-pic img {
      width: 100%;
      height: 100%;
    }
    .profile-name {
      flex: 1;
      font-size: 0.9rem;
    }
    /* “更多设置”三点图标放侧边栏底部右侧 */
    .more-options {
      width: 24px;
      height: 24px;
      cursor: pointer;
    }
    /* ===== 主区域 ===== */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      background-color: #FFFFFF;
      transition: background-color 0.3s;
    }
    body.dark .main {
      background-color: #18191A;
    }
    /* 聊天窗口 */
    .chat-window {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
    }
    .chat-window::-webkit-scrollbar {
      width: 0;
      background: transparent;
    }
    .message {
      display: flex;
      margin-bottom: 10px;
      opacity: 0;
      transform: translateY(20px);
      animation: slide-in 0.25s forwards;
    }
    @keyframes slide-in {
      to { opacity: 1; transform: translateY(0); }
    }
    .message.ai { justify-content: flex-start; }
    .message.user { justify-content: flex-end; }
    .message .avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      margin-right: 4px;
      flex-shrink: 0;
    }
    .message .bubble {
      max-width: 95%;
      padding: 6px 10px;
      font-size: 0.8rem;
      line-height: 1.3;
      word-break: break-word;
      border-radius: 8px;
      background-color: #E5E5E5;
      color: #1A1A1A;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark .message .bubble {
      background-color: #282B30;
      color: #E3E5E8;
    }
    .message.ai .bubble { border-radius: 8px 8px 8px 0; }
    .message.user .bubble { border-radius: 8px 8px 0 8px; }

    /* 输入区 */
    .chat-input {
      display: flex;
      align-items: center;
      padding: 6px 10px;
      border-top: 1px solid #DDDDDD;
      background-color: #EEEEEE;
      transition: background-color 0.3s, border-color 0.3s;
    }
    body.dark .chat-input {
      border-top: 1px solid #2F3136;
      background-color: #202225;
    }
    .chat-input input {
      flex: 1;
      height: 30px;
      padding: 0 12px;
      border: none;
      border-radius: 6px;
      font-size: 0.8rem;
      background-color: #FFFFFF;
      color: #1A1A1A;
      outline: none;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark .chat-input input {
      background-color: #2F3136;
      color: #E3E5E8;
    }
    .chat-input input::placeholder {
      color: #888888;
      opacity: 0.6;
    }
    .icon-btn {
      width: 26px;
      height: 26px;
      margin-left: 5px;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s, color 0.3s;
      flex-shrink: 0;
    }
    .icon-btn img {
      width: 100%;
      height: 100%;
    }
    .icon-btn:hover {
      background-color: rgba(0,0,0,0.05);
    }
    body.dark .icon-btn:hover {
      background-color: rgba(255,255,255,0.1);
    }

    /* 加载动画 */
    .loading-container {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .loading-gif {
      width: 24px;
      height: 24px;
    }

    /* ===== 响应式适配 ===== */
    @media (max-width: 1024px) {
      .sidebar {
        width: 30%;
      }
    }
    @media (max-width: 768px) {
      .sidebar {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        transform: translateY(-100%);
        z-index: 10;
        height: 100vh;
      }
      .sidebar.visible {
        transform: translateY(0);
      }
      .main {
        margin-top: 56px;
      }
    }
    @media (max-width: 480px) {
      .sidebar-header {
        padding: 10px;
      }
      .sidebar-header img {
        width: 20px;
        height: 20px;
      }
      .sidebar-header span {
        font-size: 0.85rem;
      }
      .new-chat-btn {
        margin: 4px 8px;
        padding: 4px 8px;
        font-size: 0.8rem;
      }
      .new-chat-btn img {
        width: 16px;
        height: 16px;
      }
      .chat-list {
        padding: 8px;
        font-size: 0.75rem;
      }
      .sidebar-footer {
        padding: 8px;
      }
      .profile-pic {
        width: 24px;
        height: 24px;
      }
      .profile-pic img {
        width: 100%;
        height: 100%;
      }
      .profile-name {
        font-size: 0.75rem;
      }
      .more-options {
        width: 20px;
        height: 20px;
      }
      .chat-window {
        padding: 8px 6px;
      }
      .message {
        margin-bottom: 8px;
      }
      .message .avatar {
        width: 20px;
        height: 20px;
        margin-right: 4px;
      }
      .message .bubble {
        padding: 4px 8px;
        font-size: 0.75rem;
      }
      .chat-input {
        padding: 4px 8px;
      }
      .chat-input input {
        height: 28px;
        font-size: 0.75rem;
        padding: 0 8px;
      }
      .icon-btn {
        width: 24px;
        height: 24px;
        margin-left: 4px;
      }
      .icon-btn img {
        width: 100%;
        height: 100%;
      }
      .loading-gif {
        width: 20px;
        height: 20px;
      }
    }
    @media (max-width: 320px) {
      .sidebar, .main {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        max-width: none;
        min-width: 0;
      }
      .chat-window {
        font-size: 0.7rem;
      }
      .chat-input input {
        font-size: 0.7rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 侧边栏 -->
    <aside class="sidebar" id="sidebar">
      <div>
        <!-- 侧边栏头部 -->
        <div class="sidebar-header">
          <img src="deepseek.png" alt="DeepSeek 图标" />
          <span>DeepSeek</span>
        </div>
        <!-- 新对话按钮 -->
        <button class="new-chat-btn" id="newChatBtn">
          <img src="new.xml" alt="新对话" />
          <span>新对话</span>
        </button>
        <!-- 聊天历史列表 -->
        <div class="chat-list" id="chatList">
          <p>无对话记录</p>
        </div>
      </div>
      <!-- 侧边栏底部：我的资料 + 更多设置（三点） -->
      <div class="sidebar-footer">
        <div class="profile-pic">
          <img src="profile.xml" alt="用户头像" />
        </div>
        <div class="profile-name">我的资料</div>
        <img src="duo.xml" alt="更多设置" class="more-options" id="moreOptionsBtn" title="设置" />
      </div>
    </aside>

    <!-- 主区域 -->
    <div class="main">
      <!-- 聊天窗口 -->
      <div class="chat-window" id="chatWindow">
        <!-- JS 动态插入消息 -->
      </div>
      <!-- 输入区 -->
      <div class="chat-input">
        <input type="text" id="userInput" placeholder="请输入消息" autocomplete="off" />
        <!-- 深度思考 -->
        <button class="icon-btn" id="deepThinkBtn" title="深度思考">
          <img src="think.xml" alt="深度思考" />
        </button>
        <!-- 联网搜索 -->
        <button class="icon-btn" id="networkSearchBtn" title="联网搜索">
          <img src="wifis.xml" alt="联网搜索" />
        </button>
        <!-- 发送 -->
        <button class="icon-btn" id="uploadBtn" title="发送">
          <img src="send.xml" alt="发送" />
        </button>
      </div>
    </div>
  </div>

  <!-- 自定义回复映射表 -->
  <script src="responses.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const bodyEl = document.body;
      const sidebar = document.getElementById('sidebar');
      const newChatBtn = document.getElementById('newChatBtn');
      const chatList = document.getElementById('chatList');
      const chatWindow = document.getElementById('chatWindow');
      const userInput = document.getElementById('userInput');
      const deepThinkBtn = document.getElementById('deepThinkBtn');
      const networkSearchBtn = document.getElementById('networkSearchBtn');
      const uploadBtn = document.getElementById('uploadBtn');
      const moreOptionsBtn = document.getElementById('moreOptionsBtn');

      // 加载历史
      function loadChatHistory() {
        const saved = localStorage.getItem('deepseek_chat_history');
        if (saved) {
          chatWindow.innerHTML = saved;
          const msgs = chatWindow.querySelectorAll('.message');
          msgs.forEach(msg => { msg.style.opacity = '1'; msg.style.transform = 'translateY(0)'; });
          const firstBubble = chatWindow.querySelector('.message.user .bubble') || chatWindow.querySelector('.message.ai .bubble');
          if (firstBubble) {
            chatList.innerHTML = `<p>${firstBubble.textContent}</p>`;
          } else {
            chatList.innerHTML = '<p>无对话记录</p>';
          }
        }
      }
      loadChatHistory();

      // 保存历史
      function saveChatHistory() {
        localStorage.setItem('deepseek_chat_history', chatWindow.innerHTML);
      }

      // 新对话
      newChatBtn.addEventListener('click', () => {
        chatWindow.innerHTML = '';
        chatList.innerHTML = '<p>无对话记录</p>';
        localStorage.removeItem('deepseek_chat_history');
      });

      // 插入消息
      function addMessage(text, sender) {
        const messageEl = document.createElement('div');
        messageEl.classList.add('message', sender);

        if (sender === 'ai') {
          const avatarEl = document.createElement('img');
          avatarEl.src = 'deepseek.png';
          avatarEl.alt = 'DeepSeek 头像';
          avatarEl.classList.add('avatar');
          messageEl.appendChild(avatarEl);
        }

        const bubbleEl = document.createElement('div');
        bubbleEl.classList.add('bubble');
        bubbleEl.textContent = text;
        messageEl.appendChild(bubbleEl);
        chatWindow.appendChild(messageEl);

        setTimeout(() => {
          messageEl.style.opacity = '1';
          messageEl.style.transform = 'translateY(0)';
        }, 10);

        chatWindow.scrollTop = chatWindow.scrollHeight;
        if (sender === 'user' && chatList.innerHTML.includes('无对话记录')) {
          chatList.innerHTML = `<p>${text}</p>`;
        }
        saveChatHistory();
        return bubbleEl;
      }

      // 获取回复
      function getResponse(input) {
        const key = input.trim();
        let respObj = {};
        if (window.responses) respObj = window.responses;
        else if (typeof responses !== 'undefined') respObj = responses;
        if (respObj[key] !== undefined) return respObj[key];
        return '服务器繁忙，请稍后再试';
      }

      // 逐字符显示
      function typeText(el, text, speed = 90) {
        let i = 0;
        el.textContent = '';
        return new Promise(resolve => {
          const id = setInterval(() => {
            if (i < text.length) {
              el.textContent += text.charAt(i);
              i++;
            } else {
              clearInterval(id);
              saveChatHistory();
              resolve();
            }
          }, speed);
        });
      }

      // 发送消息
      async function sendMessage() {
        const text = userInput.value.trim();
        if (!text) return;
        if (chatList.innerHTML.includes('无对话记录')) chatList.innerHTML = '';
        addMessage(text, 'user');
        userInput.value = '';

        const loadingContainer = document.createElement('div');
        loadingContainer.classList.add('message', 'ai');
        const avatarEl = document.createElement('img');
        avatarEl.src = 'deepseek.png';
        avatarEl.alt = 'DeepSeek 头像';
        avatarEl.classList.add('avatar');
        loadingContainer.appendChild(avatarEl);
        const loadingGif = document.createElement('img');
        loadingGif.src = 'jz.gif';
        loadingGif.alt = '加载中';
        loadingGif.classList.add('loading-gif');
        loadingContainer.appendChild(loadingGif);
        chatWindow.appendChild(loadingContainer);
        setTimeout(() => {
          loadingContainer.style.opacity = '1';
          loadingContainer.style.transform = 'translateY(0)';
        }, 10);
        chatWindow.scrollTop = chatWindow.scrollHeight;

        await new Promise(res => setTimeout(res, 5000 + Math.random() * 2000));
        loadingGif.remove();

        const reply = getResponse(text);
        const bubbleEl = document.createElement('div');
        bubbleEl.classList.add('bubble');
        loadingContainer.appendChild(bubbleEl);
        await typeText(bubbleEl, reply, 90);
      }

      deepThinkBtn.addEventListener('click', () => {
        deepThinkBtn.classList.toggle('active');
        sendMessage();
      });
      networkSearchBtn.addEventListener('click', () => {
        networkSearchBtn.classList.toggle('active');
        sendMessage();
      });
      uploadBtn.addEventListener('click', () => {
        uploadBtn.classList.toggle('active');
        sendMessage();
      });
      userInput.addEventListener('keypress', e => {
        if (e.key === 'Enter') sendMessage();
      });

      // “更多设置”选项
      moreOptionsBtn.addEventListener('click', () => {
        const choice = prompt('输入 1 切换浅/深色主题，2 清除聊天记录');
        if (choice === '1') {
          if (bodyEl.classList.contains('light')) {
            bodyEl.classList.remove('light');
            bodyEl.classList.add('dark');
          } else {
            bodyEl.classList.remove('dark');
            bodyEl.classList.add('light');
          }
        } else if (choice === '2') {
          chatWindow.innerHTML = '';
          chatList.innerHTML = '<p>无对话记录</p>';
          localStorage.removeItem('deepseek_chat_history');
        }
      });
    });
  </script>
</body>
</html>