<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šåŠŸèƒ½äºŒç»´ç ç”Ÿæˆå™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .control-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .theme-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .theme-option {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            background: white;
        }

        .theme-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .theme-option.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .color-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .color-group {
            text-align: center;
        }

        .color-group input[type="color"] {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            margin: 0 auto;
        }

        .preview-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .qr-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: inline-block;
        }

        #qrcode {
            margin: 0 auto;
        }

        .download-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .logo-upload {
            margin-bottom: 15px;
        }

        .logo-preview {
            width: 80px;
            height: 80px;
            border: 2px dashed #ccc;
            border-radius: 10px;
            margin: 10px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
        }

        .logo-preview img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 5px;
        }

        .pattern-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .pattern-option {
            width: 40px;
            height: 40px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .pattern-option.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .theme-selector {
                grid-template-columns: repeat(2, 1fr);
            }

            .download-section {
                grid-template-columns: 1fr;
            }
        }

        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            color: #27ae60;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âœ¨ å¤šåŠŸèƒ½äºŒç»´ç ç”Ÿæˆå™¨</h1>
            <p>æ”¯æŒå¤šç§ä¸»é¢˜ã€è‡ªå®šä¹‰æ ·å¼ã€Logoæ’å…¥å’Œé«˜è´¨é‡ä¸‹è½½</p>
        </div>

        <div class="main-content">
            <div class="control-panel">
                <div class="form-group">
                    <label for="qrText">äºŒç»´ç å†…å®¹</label>
                    <textarea id="qrText" rows="3" placeholder="è¾“å…¥è¦ç”ŸæˆäºŒç»´ç çš„å†…å®¹...">https://example.com</textarea>
                    <div class="error-message" id="textError">è¯·è¾“å…¥æœ‰æ•ˆçš„å†…å®¹</div>
                </div>

                <div class="form-group">
                    <label for="qrSize">äºŒç»´ç å°ºå¯¸</label>
                    <select id="qrSize">
                        <option value="200">200x200 (å°)</option>
                        <option value="300" selected>300x300 (ä¸­)</option>
                        <option value="400">400x400 (å¤§)</option>
                        <option value="500">500x500 (è¶…å¤§)</option>
                        <option value="800">800x800 (é«˜æ¸…)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ä¸»é¢˜é€‰æ‹©</label>
                    <div class="theme-selector">
                        <div class="theme-option active" data-theme="classic">ç»å…¸é»‘ç™½</div>
                        <div class="theme-option" data-theme="blue">è“è‰²æ¸å˜</div>
                        <div class="theme-option" data-theme="purple">ç´«è‰²æ¢¦å¹»</div>
                        <div class="theme-option" data-theme="green">è‡ªç„¶ç»¿è‰²</div>
                        <div class="theme-option" data-theme="red">çƒ­æƒ…çº¢è‰²</div>
                        <div class="theme-option" data-theme="custom">è‡ªå®šä¹‰</div>
                    </div>
                </div>

                <div class="form-group" id="customColors" style="display: none;">
                    <label>è‡ªå®šä¹‰é¢œè‰²</label>
                    <div class="color-inputs">
                        <div class="color-group">
                            <label>å‰æ™¯è‰²</label>
                            <input type="color" id="foregroundColor" value="#000000">
                        </div>
                        <div class="color-group">
                            <label>èƒŒæ™¯è‰²</label>
                            <input type="color" id="backgroundColor" value="#ffffff">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>äºŒç»´ç æ ·å¼</label>
                    <div class="pattern-selector">
                        <div class="pattern-option active" data-pattern="square">â– </div>
                        <div class="pattern-option" data-pattern="circle">â—</div>
                        <div class="pattern-option" data-pattern="rounded">â¬›</div>
                        <div class="pattern-option" data-pattern="dot">â€¢</div>
                    </div>
                </div>

                <div class="form-group logo-upload">
                    <label for="logoUpload">ä¸­å¿ƒLogo (å¯é€‰)</label>
                    <input type="file" id="logoUpload" accept="image/*">
                    <div class="logo-preview" id="logoPreview">
                        <span>é¢„è§ˆ</span>
                    </div>
                </div>

                <button class="btn" onclick="generateQR()" style="width: 100%; margin-bottom: 10px;">
                    ğŸ¨ ç”ŸæˆäºŒç»´ç 
                </button>
                <div class="success-message" id="generateSuccess">äºŒç»´ç ç”ŸæˆæˆåŠŸï¼</div>
            </div>

            <div class="preview-panel">
                <h3>äºŒç»´ç é¢„è§ˆ</h3>
                <div class="qr-container">
                    <div id="qrcode"></div>
                </div>

                <div class="download-section">
                    <button class="btn" onclick="downloadQR('png')">
                        ğŸ“¥ ä¸‹è½½ PNG
                    </button>
                    <button class="btn" onclick="downloadQR('jpg')">
                        ğŸ“¥ ä¸‹è½½ JPG
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentQR = null;
        let currentLogo = null;
        let currentTheme = 'classic';
        let currentPattern = 'square';

        // ä¸»é¢˜é…ç½®
        const themes = {
            classic: { fg: '#000000', bg: '#ffffff' },
            blue: { fg: '#1e3a8a', bg: '#dbeafe' },
            purple: { fg: '#7c3aed', bg: '#f3e8ff' },
            green: { fg: '#059669', bg: '#d1fae5' },
            red: { fg: '#dc2626', bg: '#fee2e2' }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            generateQR();
            setupEventListeners();
        });

        function setupEventListeners() {
            // ä¸»é¢˜é€‰æ‹©
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelector('.theme-option.active').classList.remove('active');
                    this.classList.add('active');
                    currentTheme = this.dataset.theme;
                    
                    const customColors = document.getElementById('customColors');
                    if (currentTheme === 'custom') {
                        customColors.style.display = 'block';
                    } else {
                        customColors.style.display = 'none';
                    }
                    generateQR();
                });
            });

            // æ ·å¼é€‰æ‹©
            document.querySelectorAll('.pattern-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelector('.pattern-option.active').classList.remove('active');
                    this.classList.add('active');
                    currentPattern = this.dataset.pattern;
                    generateQR();
                });
            });

            // å®æ—¶æ›´æ–°
            document.getElementById('qrText').addEventListener('input', generateQR);
            document.getElementById('qrSize').addEventListener('change', generateQR);
            document.getElementById('foregroundColor').addEventListener('change', generateQR);
            document.getElementById('backgroundColor').addEventListener('change', generateQR);

            // Logoä¸Šä¼ 
            document.getElementById('logoUpload').addEventListener('change', handleLogoUpload);
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentLogo = e.target.result;
                    const preview = document.getElementById('logoPreview');
                    preview.innerHTML = `<img src="${currentLogo}" alt="Logo">`;
                    generateQR();
                };
                reader.readAsDataURL(file);
            }
        }

        function generateQR() {
            const text = document.getElementById('qrText').value.trim();
            const size = parseInt(document.getElementById('qrSize').value);
            
            // éªŒè¯è¾“å…¥
            if (!text) {
                document.getElementById('textError').style.display = 'block';
                return;
            } else {
                document.getElementById('textError').style.display = 'none';
            }

            try {
                // æ¸…ç©ºä¹‹å‰çš„äºŒç»´ç 
                const qrcodeDiv = document.getElementById('qrcode');
                qrcodeDiv.innerHTML = '';

                // åˆ›å»ºäºŒç»´ç 
                const qr = qrcode(0, 'M');
                qr.addData(text);
                qr.make();

                // è·å–é¢œè‰²
                let fgColor, bgColor;
                if (currentTheme === 'custom') {
                    fgColor = document.getElementById('foregroundColor').value;
                    bgColor = document.getElementById('backgroundColor').value;
                } else {
                    fgColor = themes[currentTheme].fg;
                    bgColor = themes[currentTheme].bg;
                }

                // åˆ›å»ºCanvas
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = size;
                canvas.height = size;

                // ç»˜åˆ¶äºŒç»´ç 
                drawQRCode(ctx, qr, size, fgColor, bgColor, currentPattern);

                // æ·»åŠ Logo
                if (currentLogo) {
                    addLogoToCanvas(ctx, currentLogo, size);
                }

                // æ˜¾ç¤ºäºŒç»´ç 
                qrcodeDiv.appendChild(canvas);
                currentQR = canvas;

                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                const successMsg = document.getElementById('generateSuccess');
                successMsg.style.display = 'block';
                setTimeout(() => successMsg.style.display = 'none', 2000);

            } catch (error) {
                console.error('ç”ŸæˆäºŒç»´ç æ—¶å‡ºé”™:', error);
                document.getElementById('textError').textContent = 'ç”ŸæˆäºŒç»´ç æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥è¾“å…¥å†…å®¹';
                document.getElementById('textError').style.display = 'block';
            }
        }

        function drawQRCode(ctx, qr, size, fgColor, bgColor, pattern) {
            const modules = qr.getModuleCount();
            const moduleSize = size / modules;

            // å¡«å……èƒŒæ™¯
            ctx.fillStyle = bgColor;
            ctx.fillRect(0, 0, size, size);

            // ç»˜åˆ¶äºŒç»´ç æ¨¡å—
            ctx.fillStyle = fgColor;
            for (let row = 0; row < modules; row++) {
                for (let col = 0; col < modules; col++) {
                    if (qr.isDark(row, col)) {
                        const x = col * moduleSize;
                        const y = row * moduleSize;
                        
                        switch (pattern) {
                            case 'circle':
                                ctx.beginPath();
                                ctx.arc(x + moduleSize/2, y + moduleSize/2, moduleSize/2 * 0.8, 0, 2 * Math.PI);
                                ctx.fill();
                                break;
                            case 'rounded':
                                drawRoundedRect(ctx, x, y, moduleSize * 0.9, moduleSize * 0.9, moduleSize * 0.2);
                                break;
                            case 'dot':
                                ctx.beginPath();
                                ctx.arc(x + moduleSize/2, y + moduleSize/2, moduleSize/4, 0, 2 * Math.PI);
                                ctx.fill();
                                break;
                            default: // square
                                ctx.fillRect(x, y, moduleSize, moduleSize);
                                break;
                        }
                    }
                }
            }
        }

        function drawRoundedRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
            ctx.fill();
        }

        function addLogoToCanvas(ctx, logoSrc, canvasSize) {
            const img = new Image();
            img.onload = function() {
                const logoSize = canvasSize * 0.2;
                const x = (canvasSize - logoSize) / 2;
                const y = (canvasSize - logoSize) / 2;

                // ç»˜åˆ¶ç™½è‰²èƒŒæ™¯åœ†å½¢
                ctx.fillStyle = '#ffffff';
                ctx.beginPath();
                ctx.arc(canvasSize/2, canvasSize/2, logoSize/2 + 5, 0, 2 * Math.PI);
                ctx.fill();

                // ç»˜åˆ¶Logo
                ctx.save();
                ctx.beginPath();
                ctx.arc(canvasSize/2, canvasSize/2, logoSize/2, 0, 2 * Math.PI);
                ctx.clip();
                ctx.drawImage(img, x, y, logoSize, logoSize);
                ctx.restore();
            };
            img.src = logoSrc;
        }

        function downloadQR(format) {
            if (!currentQR) {
                alert('è¯·å…ˆç”ŸæˆäºŒç»´ç ');
                return;
            }

            try {
                const link = document.createElement('a');
                const timestamp = new Date().getTime();
                
                if (format === 'png') {
                    link.download = `qrcode_${timestamp}.png`;
                    link.href = currentQR.toDataURL('image/png');
                } else if (format === 'jpg') {
                    link.download = `qrcode_${timestamp}.jpg`;
                    link.href = currentQR.toDataURL('image/jpeg', 0.9);
                }
                
                link.click();
            } catch (error) {
                console.error('ä¸‹è½½å¤±è´¥:', error);
                alert('ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }
    </script>
</body>
</html>
